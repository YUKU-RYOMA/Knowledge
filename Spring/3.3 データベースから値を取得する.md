
## 1ï¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆPOSTãƒ¡ã‚½ãƒƒãƒ‰ï¼‰

HTMLã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ã£ã¦ã€POSTãƒ¡ã‚½ãƒƒãƒ‰ã§HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹

## 2~3ï¼å€¤
ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯ç”»é¢ã‹ã‚‰å…¥åŠ›ã•ã‚ŒãŸå€¤ã‚’ã‚µãƒ¼ãƒ“ã‚¹ã€ãƒªãƒã‚¸ãƒˆãƒªã«æ¸¡ã—ã¾ã™ã€‚

## 4ï¼æ¤œç´¢
ãƒªãƒã‚¸ãƒˆãƒªã¯ã€EMPLOYEEãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ¤œç´¢ã—ã¾ã™ã€‚

## 5~6ï¼æ¤œç´¢çµæœ
ãƒªãƒã‚¸ãƒˆãƒªã€ã‚µãƒ¼ãƒ“ã‚¹ãŒæ¤œç´¢çµæœã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«è¿”ã—ã¾ã™ã€‚

## 7ï¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
ãƒ–ãƒ©ã‚¦ã‚¶ã«db.htmlã‚’è¿”ã™ã€‚


### ã‚µãƒ¼ãƒ“ã‚¹ã¨ã¯ãƒ»ãƒ»ãƒ»
ã‚µãƒ¼ãƒ“ã‚¹ã¯ã„ã‚ã„ã‚ãªå‡¦ç†ã‚’ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹ã€‚
ä½•ã‚‰ã‹ã®è¨ˆç®—ã‚„ã€ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½¿ã£ãŸã‚Šã™ã‚‹ã€‚

ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã¯å‡¦ç†ã‚’è¡Œã‚ãšã€ã‚µãƒ¼ãƒ“ã‚¹ã«å‡¦ç†ã‚’ä»»ã›ã‚‹ã€‚
ã‚µãƒ¼ãƒ“ã‚¹ãŒã™ã¹ã¦ã®å‡¦ç†ã‚’è¡Œã†ã€‚
ã“ã†ã™ã‚‹ã“ã¨ã§ã€åˆ¥ã®ç”»é¢ã§åŒã˜å‡¦ç†ã‚’è¡Œã†å ´åˆã€åŒã˜ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚

### ãƒªãƒã‚¸ãƒˆãƒªã¨ã¯ãƒ»ãƒ»ãƒ»
ãƒªãƒã‚¸ãƒˆãƒªã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£ã®å‡¦ç†ã‚’è¡Œã†ã‚¯ãƒ©ã‚¹ã€‚

## H2ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
H2ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã¯ã€ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªå‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€‚
ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªå‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¡ãƒ¢ãƒªä¸Šã«æŒã¤ã€‚
ã¤ã¾ã‚Šã€Spring Bootã®èµ·å‹•ä¸­ã—ã‹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ãˆãªã„ã€‚
Spring Bootã‚’å†èµ·å‹•ã™ã‚‹ã¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚ãƒ‡ãƒ¼ã‚¿ã‚‚æ¶ˆãˆã¦ã—ã¾ã†ã€‚
ãã®ä»•çµ„ã¿ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ†ã‚¹ãƒˆã‚„å­¦ç¿’ãªã©ã«H2ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒåˆ©ç”¨ã•ã‚Œã‚‹ã€‚

Spring Bootã‚’èµ·å‹•ã™ã‚‹ãŸã³ã«ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œæˆã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚
ã ã‹ã‚‰ã€Spring Bootã®èµ·å‹•æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹SQLã‚’ç”¨æ„ã™ã‚‹ã€‚

**ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã®SQL**
- spring.datasource.schema
**åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥ã®SQL**
- spring.datasource.data

ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«è¨­å®šã—ã¦ã„ã‚‹ã€Œclasspath:ã€ã¨ã„ã†ã®ã¯ã€src/main/resourcesã®ã“ã¨ã€‚

**schema.sql**ã€€ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã®SQL
***
CREATE TABLE IF NOT EXISTS employee (
	id VARCHAR(50) PRIMARY KEY,
	 name VARCHAR(50),
	 age INT
);
***

**data.sql**ã€€åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥ã™ã‚‹SQL
***
INSER INTO employee(id, name, age)
VALUES('1', 'Tom', 30);
***

æ¤œç´¢çµæœã‚’å…¥ã‚Œã‚‹ãŸã‚ã®Employeeã‚¯ãƒ©ã‚¹
**Employee.java**
***
package com.example.hello;
import lombok.Data;

@Data
public class Employee {
	private String employeeId;
	private String employeeName;
	private int employeeAge;
}
***

## @Data ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
@Dataã¯LombokãŒç”¨æ„ã—ã¦ã„ã‚‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€‚
ã“ã‚Œã‚’ä»˜ã‘ã‚‹ã¨ä»¥ä¸‹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è‡ªå‹•ã§ç”Ÿæˆã™ã‚‹

- getter
- setter
- toString
- hashCode
- equals

ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’å¤‰æ›´ã—ã¦ã‚‚ã€getterã‚„setterã‚’ä½œã‚Šç›´ã™æ‰‹é–“ãŒçœã‘ã‚‹ã€‚
Lombokã«ã¯ã€ã»ã‹ã«ã‚‚ä¾¿åˆ©ãªã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹ã€‚


## DBã‹ã‚‰å¾“æ¥­å“¡ã‚’æ¤œç´¢ã™ã‚‹å‡¦ç†
JDBCã‚’ä½¿ã£ã¦ã€selectæ–‡ã‚’å®Ÿè¡Œã™ã‚‹

**HelloRepository**
***
package com.example.hello;

import java.util.Map;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

@Repository
public class HelloRepository {
	@Autowired
		private JdbcTemplate jdbcTemplate;
		public Map<String, Object>findById(String id) {
			// SELECTæ–‡
			String query = "SELECT *" + "FROM employee" + "WHERE id = ?";

			// æ¤œç´¢å®Ÿè¡Œ
			Map<String, Object> employee = jdbcTemplate.queryForMap(query, id);
		return employee;
		}
}
***

## @Repository
DBæ“ä½œã‚’è¡¨ã™ãƒªãƒã‚¸ãƒˆãƒªã«ã¯ã“ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚‹ã€‚

## @Autowired
DIï¼ˆä¾å­˜æ€§æ³¨å…¥ï¼‰ã‚’ä½¿ã†ãŸã‚ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

## JdbcTemplate
JdbcTemplateã‚¯ãƒ©ã‚¹ã‚’ä½¿ãˆã°ã€JDBCã‚’ä½¿ã£ã¦ã€SQLã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ä»Šå›ã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯ã€selectæ–‡ã®çµæœã‚’Mapã§å–å¾—ã™ã‚‹ã€‚
	ã“ã®Mapã®ã‚­ãƒ¼ã«ã¯ã€selectçµæœã®ã‚«ãƒ©ãƒ åãŒå…¥ã£ã¦ã„ã¦ã€Mapã®å€¤ã«ã¯ã€selectçµæœã«å€¤ãŒå…¥ã‚‹ã€‚

## ã‚µãƒ¼ãƒ“ã‚¹ã®ä½œæˆ
ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½¿ã£ã¦SQLã®å®Ÿè¡Œçµæœã‚’å–å¾—ã™ã‚‹ã€‚

**HelloService.java**
***
package com.example.hello;

import java.util.Map;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class HelloService {
	@Autowired
	private HelloRepository repository;

	/** å¾“æ¥­å“¡ã‚’ä¸€äººå–å¾—ã™ã‚‹ **/
	public Employee getEmployee(String id) {
		// æ¤œç´¢
		Map<String, Object>map = repository.findById(id);
		
		// Mapã‹ã‚‰å€¤ã‚’å–å¾—
		String employeeId = (String)map.get("id");
		String name = (String)map.get("name");
		int age = (Integer)map.get("age");

		// Employeeã‚¯ãƒ©ã‚¹ã«å€¤ã‚’ã‚»ãƒƒãƒˆ
		Employee employee = new Employee();
		employee.setEmployeeId(employeeId);
		employee.setEmployee.Name(name);
		employee.setEmployeeAge(age);
		
		return employee;
	}
}
***
ğŸ‘†selectæ–‡ã®å®Ÿè¡Œçµæœã‹ã‚‰Employeeã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç”Ÿæˆã—ã¦ã„ã‚‹ã€‚

## Controllerã®ä½œæˆ

**HelloController.java**
***
package com.example.hello;

import org.springframework.beans.factory.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
public class HelloController {
	@AutoWired
	private HelloService service;

	@GetMapping("/hello")
	public String getHello() {
		// hello.htmlã«ç”»é¢é·ç§»
		return "hello";
	}

	@PostMapping("/hello")
		public String postRequest
		(@RequestParam("text1")String str, Model model) 
		{
			// ç”»é¢ã‹ã‚‰å—ã‘å–ã£ãŸæ–‡å­—åˆ—ã‚’Modelã«ç™»éŒ²
			model.addAttribute("sample", str);
		    // response.htmlã«ç”»é¢é·ç§»
		    return "hello/response";
	}
	@PostMapping("/hello/db")
	public String postDbRequest(@RequestParam("text2)String id, Model model) {
		// 1ä»¶æ¤œç´¢
		Employee employee = service.getEmployee(id);

		// æ¤œç´¢çµæœã‚’Modelã«ç™»éŒ²
		model.addAttribute("employee", employee);

		// db.htmlã«ç”»é¢é·ç§»
		retrun "hello/db";
	}
}
***
ğŸ‘†ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰å–å¾—ã—ãŸEmployeeã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’Modelã«ç™»éŒ²ã—ã¦ã„ã‚‹ã€‚

## Employeeã‚’è¡¨ç¤ºã™ã‚‹ç”»é¢ã‚’ä½œæˆ

**db.html**
***
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8">
		<title>ResponseSample</title>
	</head>
	<body>
		<h1>HelloResponseDB</h1>
		<table>
			<tr>
				<td>ID:</td>
				<td th:text="${employee.employeeId}"></td>
			</tr>
			<tr>
				<td>åå‰:</td>
				<td th:text="${employee.employeeName}"></td>
			</tr>
			<tr>
				<td>å¹´é½¢:</td>
				<td th:text="${employee.employeeAge}"></td>
			</tr>
		</table>
	</body>
</html>

***

ã‚¯ãƒ©ã‚¹å‹ã®å¤‰æ•°ã‚’Modelã«ç™»éŒ²ã—ãŸå ´åˆã€thå±æ€§ã«${ã‚­ãƒ¼å.ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å}ã¨æŒ‡å®šã™ã‚‹ã€‚
ã“ã‚Œã§ã€Javaã‚¯ãƒ©ã‚¹ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å€¤ã‚’å–å¾—ã§ãã‚‹ã€‚

## å¾“æ¥­å“¡IDã‚’å…¥åŠ›ã§ãã‚‹ç”»é¢ã®ä½œæˆ

**hello.html**
***
<!DOCTYPE>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8">
		<title>Hello World</title>
	</head>
	<body>
		<h1>Hello World</h1>
		<form method="post" action="/hello">
			å…¥åŠ›:<input type="text" name="text1"/>
			<input type="submit" value="ã‚¯ãƒªãƒƒã‚¯"/>
		</form>
		<br>
		<form>
			å¾“æ¥­å“¡ID:<input type="text" name="text2" th:value="${text2_value}"/>
			<input type="submit" value="ã‚¯ãƒªãƒƒã‚¯"/>
		</form>
	</body>
</html>
***


å¾“æ¥­å“¡IDã«ã€Œï¼‘ã€ã¨å…¥åŠ›ã—ã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç™»éŒ²ã—ãŸå†…å®¹ãŒåˆ¥ç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚‹